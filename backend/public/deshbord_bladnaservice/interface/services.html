<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bladna Services</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <link rel="stylesheet" href="https://localhost:3000/public/deshbord_bladnaservice/interface/srch.css">
  <link rel="stylesheet" href="srch.css">
  <style>
    #success-alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background-color: #0054A5; /* Couleur verte */
      color: white;
      border-radius: 5px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      font-weight: bold;
      z-index: 1000;
    }
    .card-tools {
    display: flex;
    justify-content: flex-start; /* Aligne les éléments à gauche */
    align-items: center; /* Aligne verticalement les éléments */
}

.card-tools .btn {
    margin-left: 10px; /* Espace entre les boutons */
}
#success-alert {
    position: fixed;
    top: 70px; /* Ajuste la valeur en fonction de la hauteur de ta navbar */
    left: 50%;
    transform: translateX(-50%);
    z-index: 1050; /* Assure-toi qu'il soit au-dessus de tout le reste */
    width: 90%; /* Ajuste la largeur de l'alerte */
    max-width: 500px;
    display: none; /* Caché par défaut */
}
html, body {
    height: 100%;
    margin: 0; /* Pour s'assurer qu'il n'y a pas d'espace blanc autour */
}

.wrapper {
    min-height: 100%;
    display: flex;
    flex-direction: column;
}

.main-sidebar {
    height: 100%; /* Assure que la sidebar prend toute la hauteur */
    position: fixed; /* Pour la garder fixe sur l'écran */
    top: 0; /* En haut de la page */
    bottom: 0; /* Joue un rôle clé pour qu'elle ne soit pas affectée par le contenu */
}
.content-wrapper {
    margin-left: 250px; /* Assure que le contenu commence après la sidebar */
    padding: 20px; /* Ajuste les espaces autour du contenu principal */
    flex-grow: 1;
    background-color: #f4f6f9; /* Pour le fond de contenu principal */
}

.navbar-nav {
    flex-grow: 1;
}

  </style>
</head>
<body class="hold-transition sidebar-mini">

  <div class="wrapper">
      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
          <ul class="navbar-nav">
              <li class="nav-item">
                  <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
              </li>
          </ul>
      </nav>
  
      <!-- Sidebar -->
      <aside class="main-sidebar sidebar-dark-primary elevation-4">
          <a href="tableauBord.html" class="brand-link">
            <img src="logo.png" alt="Bladna Services Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
              <span class="brand-text font-weight-light">Bladna Services</span>
          </a>
          <div class="sidebar">
              <nav class="mt-2">
                  <ul class="nav nav-pills nav-sidebar flex-column">
                      <li class="nav-item">
                          <a href="tableauBord.html" class="nav-link active" style="background-color: #343A40;">
                              <i class="nav-icon fas fa-tachometer-alt"></i>
                              <p>Tableau de bord</p>
                          </a>
                      </li>
                      <li class="nav-header">Gestion des utilisateurs</li>
                      <li class="nav-item">
                          <a href="client.html" class="nav-link">
                              <i class="nav-icon fas fa-users"></i>
                              <p>Tous les clients</p>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a href="prestatire.html" class="nav-link">
                              <i class="nav-icon fas fa-users"></i>
                              <p>Tous les Prestataires</p>
                          </a>
                      </li>
                      <li class="nav-item">
                          <a href="demandeValidation.html"  class="nav-link ">
                              <i class="nav-icon fas fa-hourglass-half"></i>
                              <p>Validation</p>
                          </a>
                      </li>
                      <li class="nav-item">
                        <a href="reservation.html"  class="nav-link ">
                            <i class="nav-icon fas fa-users"></i>
                            <p>reservation</p>
                        </a>
                    </li>
                    <li class="nav-item">
                      <a href="services.html" class="nav-link custom-blue">
                          <i class="nav-icon fas fa-cogs"></i> <!-- Icône représentant la gestion des services -->
                          <p>Gestion des services</p>
                      </a>
                  </li>
                  
                  <li class="nav-item">
                      <a href="city.html" class="nav-link ">
                          <i class="nav-icon fas fa-city"></i> <!-- Icône représentant la gestion des villes -->
                          <p>Gestion des villes</p>
                      </a>
                  </li>
                
                
                      <li class="nav-item">
                          <a href="../login/login.html" class="nav-link text-danger">
                              <i class="nav-icon fas fa-sign-out-alt"></i>
                              <p>Déconnexion</p>
                          </a>
                      </li>
                  </ul>
              </nav>
          </div>
      </aside>
<!-- Contenu principal --> 
<div class="content-wrapper">
  <section class="content">
      <div class="card">
          <!-- Ajout du bouton Ajouter -->
          <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title"><b>Liste des Services</b></h3>
        
            <!-- Barre de recherche -->
            <input type="text" id="searchInput" class="form-control w-25 mb-0" placeholder="Rechercher un Service...">
            <!-- Bouton Ajouter -->
            <div class="ml-3">
              <button type="button" class="btn btn-success" style="margin-left: 10px;" onclick="ajouterService()"> 
                <i class="fas fa-plus"></i> Ajouter
            </button>
                  
            </div>
        </div>
        

          <div class="card-body p-0">
              <table class="table table-striped projects">
                  <thead>
                      <tr>
                          <th>#</th>
                          <th>Services</th>
                          <th>Supprimer</th>
                      </tr>
                  </thead>
                  <tbody id="prestataires-list">
                      <tr id="noResultsMessage" style="display: none;">
                          <td colspan="3" class="text-center text-danger">Aucun Service trouvé</td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>
  </section>
</div>

<!-- Modal pour ajouter un service -->
<div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="addServiceModalLabel">Ajouter un service</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <form id="addServiceForm">
                  <div class="form-group">
                      <label for="serviceTitle">Nom du service</label>
                      <input type="text" class="form-control" id="serviceTitle" placeholder="Entrez le nom du service">
                  </div>
              </form>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
              <button type="button" class="btn btn-primary" id="addServiceButton">Ajouter</button>
          </div>
      </div>
  </div>
</div>

<!-- Alert de succès -->
<div id="success-alert" class="alert alert-success text-center" style="display: none;">
  <strong>Succès !</strong> Service ajouté avec succès !
</div>
<div id="success-alert-supprimer" class="alert alert-success text-center" style="display: none;">
  <strong>Succès !</strong> Service suppremé avec succès !
</div>


<!-- Modale de confirmation pour la suppression -->
<div id="confirmDeleteModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title">Confirmer la suppression</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <p>Êtes-vous sûr de vouloir supprimer ce service ?</p>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Non</button>
              <button type="button" class="btn btn-danger" id="confirmDeleteButton">Oui, Supprimer</button>
          </div>
      </div>
  </div>
</div>

<!-- Div pour afficher un message d'erreur -->
<div id="error-alert" class="alert alert-danger" style="display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999;">
  <strong>Erreur : </strong> Ce service est déjà utilisé. !
</div>

<script src="../env.js"></script> <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script> 
  $(document).ready(function () {
    let servicesList = [];
    let serviceIdToDelete = null; // Variable pour stocker l'ID du service à supprimer

    // Charger les services au démarrage
    function chargerServices() {
      $.get(`${Environment.apiHost}/services`, function (data) {
        servicesList = data.services; // Stocker la liste des services
        afficherServices(servicesList);
      });
    }

    // Afficher les services
    function afficherServices(services) {
      let tbody = $("#prestataires-list");
      tbody.empty(); // Vider le tableau avant d'ajouter de nouvelles lignes

      if (services.length === 0) {
        tbody.append(`<tr><td colspan="3" class="text-center">Aucun service trouvé</td></tr>`);
        return;
      }

      services.forEach((service, index) => {
        let row = `
          <tr>
            <td>${index + 1}</td>
            <td>${service.title || "N/A"}</td>
            <td class="project-actions text-right">
              <a class="btn btn-danger btn-sm" href="#" onclick="demanderSuppression(${service.service_id})">
                <i class="fas fa-trash"></i> Supprimer
              </a>
            </td>
          </tr>
        `;
        tbody.append(row);
      });
    }

    // Demander confirmation pour supprimer un service
    window.demanderSuppression = function (service_id) {
      serviceIdToDelete = service_id; // Stocker l'ID du service
      $("#confirmDeleteModal").modal("show"); // Afficher la modale de confirmation
    };

    // Confirmer la suppression du service
    $("#confirmDeleteButton").click(function () {
      if (serviceIdToDelete) {
        $.ajax({
          url: `${Environment.apiHost}/services/${serviceIdToDelete}`,
          type: "DELETE",
          success: function () {
            $("#confirmDeleteModal").modal("hide");
            $("#success-alert-supprimer").show().delay(3000).fadeOut();
            chargerServices(); // Recharger la liste après suppression
          },
          error: function () {
            $("#error-alert").fadeIn().delay(3000).fadeOut();
          }
        });
      }
    });

    // Fonction pour afficher la modal d'ajout
    window.ajouterService = function () {
      $("#addServiceModal").modal("show");
    };

    // Ajouter un service via AJAX
    $("#addServiceButton").click(function () {
      let serviceData = {
        title: $("#serviceTitle").val().trim(),
      };

      if (!serviceData.title) {
        alert("Le champ titre est requis !");
        return;
      }

      $.ajax({
        url: `${Environment.apiHost}/servicesAdd`,
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(serviceData),
        success: function () {
          $("#addServiceModal").modal("hide");
          $("#success-alert").show().delay(3000).fadeOut();
          chargerServices(); // Recharger la liste après ajout
        },
        error: function () {
          alert("Erreur lors de l'ajout du service");
        }
      });
    });

    // 🔍 Filtrage des services localement sans requête AJAX
    $("#searchInput").on("input", function () {
      let searchTerm = $(this).val().toLowerCase();
      let filteredServices = servicesList.filter(service =>
        (service.title || "").toLowerCase().includes(searchTerm)
      );
      afficherServices(filteredServices);
    });

    // Charger les services au démarrage
    chargerServices();
  });
</script>


</script>
</body>
</html>

